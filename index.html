<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Juego de Memoria REACT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      /* Fondo general inspirado en el portal de Rick */
      body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        background: radial-gradient(circle at 30% 30%, #a8ff78, #78ffd6, #00c3ff);
        font-family: 'Poppins', sans-serif;
      }
    
      /* TÃ­tulo estilo Rick and Morty moderno */
      h1 {
        margin-top: 30px;
        font-size: 2.8rem;
        color: #1b1b1b;
        text-shadow: 2px 2px 6px #00ff9d, 0 0 10px #00c3ff;
      }
    
      /* Contenedor del tablero */
      .container {
        width: 720px;
        height: 720px;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin: 40px auto;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 25px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(8px);
      }
    
      /* Cada carta */
      .card {
        background: linear-gradient(145deg, #00ff9d, #00c3ff);
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        cursor: pointer;
        position: relative;
        perspective: 1000px; /* Necesario para efecto 3D */
      }
    
      .card:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
      }
    
      /* Parte interna que rota */
      .card-inner {
        width: 100%;
        height: 100%;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.8s ease;
      }
    
      /* Cuando estÃ¡ volteada */
      .card.volteada .card-inner {
        transform: rotateY(180deg);
      }
    
      /* Caras de la carta */
      .card-front, .card-back {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        border-radius: 20px;
        overflow: hidden;
      }
    
      /* Parte delantera (Â¿?) */
      .card-front {
        background: linear-gradient(145deg, #00ff9d, #00c3ff);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: bold;
        color: #0e0e0e;
      }
    
      /* Parte trasera (imagen) */
      .card-back {
        transform: rotateY(180deg);
      }
    </style>
    

    <!-- React + ReactDOM + Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>

  <body>
    <div id="root"></div>

    <script type="text/babel">
      function MemoryGame() {
        return (
          <main>
            <h1>Bienvenido a mi juego de memoria</h1>         
            <Tablero />
          </main>
        );
      }

      function Tablero() {
        const [cards, setCards] = React.useState([]);
        const [loading, setLoading] = React.useState(true);
        const [seleccionadas, setSeleccionadas] = React.useState([]);
        const [movimientos, setMovimientos] = React.useState(0);
        const [ganaste, setGanaste] = React.useState(false);

        React.useEffect(() => {
          if (cards.length > 0 && cards.every(card => card.volteada)) {
            setGanaste(true);
          }
        }, [cards]);

        async function fetchData() {
          try {
            const respuesta = await fetch('https://rickandmortyapi.com/api/character');
            const data = await respuesta.json();
      
            const mezclados = [...data.results].sort(() => Math.random() - 0.5);
            const personajes = mezclados.slice(0, 8);
      
            const imagenesPersonajes = personajes.map((personaje, index) => ({
              id: index + "-a",
              imagen: personaje.image,
              volteada: false
            }));
      
            const duplicarImagenes = [
              ...imagenesPersonajes,
              ...imagenesPersonajes.map(card => ({
                ...card,
                id: card.id.replace("-a", "-b")
              }))
            ];
      
            const mezclarImagenes = [...duplicarImagenes]
              .sort(() => Math.random() - 0.5)
              .sort(() => Math.random() - 0.5);
      
            setCards(mezclarImagenes);
          } catch (error) {
            console.error('Error fetching data:', error);
          } finally {
            setLoading(false);
          }
        }
      
        React.useEffect(() => {
          fetchData();
        }, []);
      
        function reiniciarJuego() {
          setLoading(true);
          setGanaste(false);
          setMovimientos(0);
          setSeleccionadas([]);
          fetchData();
        }
        React.useEffect(() => {
          if (seleccionadas.length === 2) {
            const [firstIndex, secondIndex] = seleccionadas;
            const firstCard = cards[firstIndex];
            const secondCard = cards[secondIndex];

            if (firstCard.imagen !== secondCard.imagen) {
              setTimeout(() => {
                const newCards = [...cards];
                newCards[firstIndex].volteada = false;
                newCards[secondIndex].volteada = false;
                setCards(newCards);
              }, 1000);
            }

            setTimeout(() => {
              setSeleccionadas([]);
            }, 1000);
          }
        }, [seleccionadas]);

        function handleClick(index) {
          const cartaSeleccionada = cards[index];

          if (cartaSeleccionada.volteada || seleccionadas.length === 2) {
            return;
          }

          const newCards = [...cards];
          newCards[index].volteada = true;
          setCards(newCards);

          setSeleccionadas([...seleccionadas, index]);

          setMovimientos(movimientos + 1)
        }

        if (loading) {
          return <h1>Cargando...</h1>;
        }

        return (
          <>
            <h2 style={{ color: "#1b1b1b", marginTop: "10px" }}>
              Movimientos: {movimientos}
            </h2>
        
            {ganaste && (
              <div style={{
                position: "fixed",
                top: 0,
                left: 0,
                width: "100%",
                height: "100%",
                backgroundColor: "rgba(0, 0, 0, 0.7)",
                display: "flex",
                justifyContent: "center",
                alignItems: "center",
                zIndex: 1000
              }}>
                <div style={{
                  background: "#ffffff",
                  padding: "40px",
                  borderRadius: "20px",
                  textAlign: "center",
                  boxShadow: "0 8px 24px rgba(0,0,0,0.5)",
                }}>
                  <h2 style={{
                    fontSize: "2.5rem",
                    color: "#00c3ff",
                    marginBottom: "20px",
                    textShadow: "1px 1px 5px #00ff9d"
                  }}>
                    Â¡Ganaste el juego! ðŸŽ‰
                  </h2>
                  <p style={{
                    fontSize: "1.5rem",
                    color: "#1b1b1b",
                    marginBottom: "20px"
                  }}>
                    Has encontrado todas las parejas en {movimientos} movimientos.
                  </p>
                  <button
                    onClick={reiniciarJuego}
                    style={{
                      marginTop: "20px",
                      padding: "10px 20px",
                      fontSize: "18px",
                      borderRadius: "10px",
                      border: "none",
                      background: "#00c3ff",
                      color: "#fff",
                      cursor: "pointer",
                      boxShadow: "0 4px 10px rgba(0, 0, 0, 0.2)",
                      transition: "transform 0.2s",
                    }}
                    onMouseOver={(e) => e.target.style.transform = "scale(1.05)"}
                    onMouseOut={(e) => e.target.style.transform = "scale(1)"}
                  >
                    Reiniciar Juego
                  </button>

                </div>
              </div>
            )}
            
            <div className="container">
            {cards.map((card, index) => (
              
              <div
                key={card.id}
                className={`card ${card.volteada ? "volteada" : ""}`}
                onClick={() => handleClick(index)}
              >
                <div className="card-inner">
                  <div className="card-front">
                    ?
                  </div>
                  <div className="card-back">
                    <img
                      src={card.imagen}
                      alt="Personaje"
                      style={{
                        width: "100%",
                        height: "100%",
                        objectFit: "cover",
                        borderRadius: "20px"
                      }}
                    />
                  </div>
                </div>
              </div>
            ))}
          </div>
        
          </>);
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<MemoryGame />);
    </script>
  </body>
</html>
